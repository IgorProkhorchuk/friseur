<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" xmlns="http://www.w3.org/1999/html">
<head th:replace="~{base :: head}"></head>
<body>
<!--<header th:replace="~{base :: header}"></header>-->

<div class="main-content slots-page" th:fragment="mainContent">
    <div class="slots-header">
        <h1 th:text="#{slots.header.title}">Verfügbare Slots</h1>
        <p th:text="#{slots.header.subtitle}">Wählen Sie einen passenden Termin – alle Zeiten sind in Echtzeit verfügbar.</p>
    </div>

    <!--
        Render each date as an accordion item. When the header is clicked the
        associated timeslots become visible. A hidden checkbox is used to
        control the open/closed state purely with CSS (no JavaScript required).
     -->
    <div class="accordion-container">
        <th:block th:each="date, iterStat : ${dates}">
            <div class="accordion-item">
                <!-- Unique checkbox per date used for toggling the accordion -->
                <input type="checkbox" class="accordion-toggle" th:id="'acc-' + ${iterStat.index}" />
                <!-- The header label references the checkbox; clicking the header toggles the checkbox -->
                <label class="accordion-header" th:for="'acc-' + ${iterStat.index}">
                    <span th:text="${#temporals.format(date, 'EEEE dd MMMM')}">date</span>
                </label>
                <!-- Content area containing the form and timeslots -->
                <div class="accordion-content">
                    <form th:action="@{/slots}" method="post">
                        <div class="slot-container">
                            <th:block th:each="slot : ${slots}">
                                <div th:if="${slot.toLocalDate()} == ${date}">
                                    <label class="timeslot">
                                        <input type="radio"
                                               name="slot"
                                               th:value="${#temporals.format(slot, 'yyyy-MM-dd HH:mm:ss')}"
                                               th:checked="${savedSlots != null and #lists.contains(savedSlots, slot)}" />
                                        <span th:text="${#temporals.format(slot, 'h:mm a')}">slot</span>
                                    </label>
                                </div>
                            </th:block>
                        </div>
                        <button type="submit" class="submit-button" hx-target="#confirmation" hx-swap="outerHTML" th:text="#{slots.button.select}">Select Time</button>
                    </form>
                </div>
            </div>
        </th:block>
        <!-- Container where the server will insert the confirmation after selecting a slot -->
        <div id="confirmation"></div>
    </div>
</div>

</body>
</html>
